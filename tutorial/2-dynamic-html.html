<html><head><title>Gavial: Creating a Counter</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="be.tzbob" /><meta name="description" content="Multi-tier Functional Reactive Programming" /><meta name="og:image" content="/gavial/img/poster.png" /><meta name="image" property="og:image" content="/gavial/img/poster.png" /><meta name="og:title" content="Gavial: Creating a Counter" /><meta name="title" property="og:title" content="Gavial: Creating a Counter" /><meta name="og:site_name" content="Gavial" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Multi-tier Functional Reactive Programming" /><link rel="icon" type="image/png" href="/gavial/img/favicon.png" /><meta name="twitter:title" content="Gavial: Creating a Counter" /><meta name="twitter:image" content="/gavial/img/poster.png" /><meta name="twitter:description" content="Multi-tier Functional Reactive Programming" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/gavial/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/gavial/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/gavial/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/gavial/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/gavial/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/gavial/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/gavial/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/gavial/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/gavial/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/gavial/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/gavial/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/gavial/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/gavial/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/gavial/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/gavial/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/gavial/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/gavial/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/gavial/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/gavial/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/gavial/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/gavial/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/gavial/css/style.css" /><link rel="stylesheet" href="/gavial/css/palette.css" /><link rel="stylesheet" href="/gavial/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/gavial/" class="brand"><div class="brand-wrapper"><span>Gavial</span></div></a></li><li><a href="/gavial/tutorial/1-introduction.html" class="">Introduction</a></li><li><a href="/gavial/tutorial/2-dynamic-html.html" class=" active ">Creating a Counter</a></li><li><a href="/gavial/" class=""></a></li><li><a href="/gavial/css/palette.css" class=""></a></li><li><a href="/gavial/css/style.css" class=""></a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/tzbob/gavial"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/tzbob/gavial"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Gavial Multi-tier Functional Reactive Programming');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Gavial Multi-tier Functional Reactive Programming');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="tzbob" data-github-repo="gavial"><div class="content-wrapper"><section><h1 id="creating-a-counter">Creating a Counter</h1>

<p>Now that you know how to get a Gavial template up and running, let us expand the hello world template to a shared counter:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">counterSource</span> <span class="k">=</span> <span class="nc">ClientEvent</span><span class="o">.</span><span class="n">source</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>

<span class="c1">// count on the server
</span><span class="k">val</span> <span class="n">sessionCounts</span>  <span class="k">=</span> <span class="nc">ClientEvent</span><span class="o">.</span><span class="n">toSession</span><span class="o">(</span><span class="n">counterSource</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sessionCounter</span> <span class="k">=</span> <span class="n">sessionCounts</span><span class="o">.</span><span class="n">fold</span><span class="o">(</span><span class="mi">0</span><span class="o">)(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">).</span><span class="n">toDBehavior</span>

<span class="c1">// count for everyone!
</span><span class="k">val</span> <span class="n">globalCounter</span> <span class="k">=</span> <span class="nc">SessionDBehavior</span><span class="o">.</span><span class="n">toApp</span><span class="o">(</span><span class="n">sessionCounter</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="o">)</span>

<span class="c1">// show everyone the global count
</span><span class="k">val</span> <span class="n">clientCounter</span> <span class="k">=</span> <span class="nc">SessionDBehavior</span><span class="o">.</span><span class="n">toClient</span><span class="o">(</span><span class="nc">AppDBehavior</span><span class="o">.</span><span class="n">toSession</span><span class="o">(</span><span class="n">globalCounter</span><span class="o">))</span>
<span class="k">val</span> <span class="n">ui</span> <span class="k">=</span> <span class="n">clientCounter</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">c</span> <span class="k">=&gt;</span>
  <span class="n">div</span><span class="o">(</span><span class="n">h1</span><span class="o">(</span><span class="s">"Count!"</span><span class="o">),</span>
      <span class="n">button</span><span class="o">(</span><span class="s">"+"</span><span class="o">,</span> <span class="nc">UI</span><span class="o">.</span><span class="n">listen</span><span class="o">(</span><span class="n">onclick</span><span class="o">,</span> <span class="n">counterSource</span><span class="o">)(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="mi">1</span><span class="o">)),</span>
      <span class="n">button</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="nc">UI</span><span class="o">.</span><span class="n">listen</span><span class="o">(</span><span class="n">onclick</span><span class="o">,</span> <span class="n">counterSource</span><span class="o">)(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">)),</span>
      <span class="n">p</span><span class="o">(</span><span class="n">c</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>First, we create a source to receive counter information.
Next, we replicate the counter events to the session tier after which we fold them into a behavior.
We replicate to the application tier as well since we want a global counter, we do this by merging all individual counters into one by picking just the values of the application replication and making a sum.
We take this global counter result back to the client tier (through the session tier) and map an interface over it.
In this interface we bind our previously created source to the <code class="highlighter-rouge">onclick</code> attribute on two separate buttons and complete our application.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/gavial/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/gavial/js/main.js"></script></body></html>